---
title: 博客主题改造计划
author: 胤
categories: [笔记本]
date: 2022-05-17 12:34:31
index_img: https://i0.hdslb.com/bfs/album/abb2f330fb6128fd320ea654f9d0b8c316a5dabe.png@600w.webp
description: 记录一次博客主题魔改过程。
---

我的博客最初使用的是 Butterlfy 主题，当时通过一系列魔改用上了全屏背景，于是乎，我就想能不能让 Fluid 主题也用上全屏背景。

在主题 Github 仓库的一条 issue 里面，作者不建议使用全屏背景，原因是手机端浏览效果可能不太理想，那我只好尝试自己魔改咯。

首先需要把原来的 Banner 头图和 Mask 蒙版清除掉，在自定义 css 文件中加入如下内容即可：

```css
#banner {
    background-image: none !important;
}

#banner .mask {
    background-color: transparent !important;
}
```

然后需要通过 Hexo 注入器在 `body` 标签的开头注入全屏背景，至于如何注入可以查看[进阶用法](https://hexo.fluid-dev.com/docs/advance/)，注入代码如下：

```javascript
hexo.extend.injector.register("body_begin", `<div id="web-bg"></div>`);
```

接下来需要设置全屏背景的 css 样式，自定义样式代码如下：

PS：你也可以自己设定喜欢的样式啦！

```css
#web-bg {
    position: fixed;
    z-index: -999;
    width: 100%;
    height: 100%;
    background-attachment: fixed;
    background-position: center;
    -webkit-background-size: cover;
    -moz-background-size: cover;
    background-size: cover;
    background-repeat: no-repeat;
    transition: background-image 0.8s ease-in;
    -moz-transition: background-image 0.8s ease-in;
    -webkit-transition: background-image 0.8s ease-in;
}
```

由于需要分别设置夜间模式和日间模式的背景图，所以我加了两个 class 来区分：

PS：这里建议使用 `base64` 编码的图片格式，这样切换主题的时候会很平滑。

```css
.bg-dark {
    background-image: url();
}

.bg-light {
    background-image: url();
}
```

接下来需要修改主题切换按钮的点击事件，在相应模式添加对应的 class 即可，主题文件夹中的 `color-schema.js` 文件就是用来控制日间模式和夜间模式主题属性的，在相应的地方添加代码即可：

```javascript
var webBackground = '#web-bg'; // 背景

// 获取类名函数
function getBackgroundClass(schema) {
    return 'bg-' + schema;
}

// 切换背景
var bg = getBackgroundClass('dark');
if (schema) {
    bg = getBackgroundClass(schema);
}

var bgElement = document.querySelector(webBackground);
if (bgElement) {
    bgElement.setAttribute('class',bg);
}
```

这样一个简单的全屏背景就设置好啦，具体效果请参考本博客。

{% note primary %}
以下为 2022.10.27 更新内容：
{% endnote %}

由于 `base64` 编码格式的图片嵌入 css 文件中会导致文件过大，所以还是使用 `https` 请求加载背景图片吧，可以使用 `preload` 或 `prefetch` 来预加载图片，也可以用 `img` 标签事先将图片下载下来，这样切换主题模式的时候图片不会出现闪白的情况，或者使用 css 预加载也行，我用的是第三种。

Hexo 注入器的修改代码如下：

```javascript
hexo.extend.filter.register('theme_inject', function(injects) {
    injects.bodyBegin.raw('default', '<div id="web-bg"></div>');
    injects.bodyEnd.raw('default', '<div id="preloadbg" style="display: none;"></div>');
});
```

在自定义 css 文件中对 `preloadbg` 背景进行预加载：

```css
#preloadbg {
    background-image: url();
    background-image: url();
}
```